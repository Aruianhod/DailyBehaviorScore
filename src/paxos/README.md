# Paxosä¸€è‡´æ€§æ£€æµ‹æœåŠ¡

è¿™æ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„Paxosåè®®å®ç°ï¼Œä¸“é—¨ä¸ºè¡Œä¸ºåˆ†ç®¡ç†ç³»ç»Ÿæä¾›åˆ†å¸ƒå¼ä¸€è‡´æ€§æ£€æµ‹ã€‚è¯¥æœåŠ¡å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–ä¸»æœåŠ¡å™¨ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

ç¡®ä¿æ‚¨å·²å®‰è£…Node.js (ç‰ˆæœ¬ >= 14.0.0)ï¼Œç„¶åå®‰è£…æ‰€éœ€ä¾èµ–ï¼š

```bash
npm install express cors axios
```

### 2. å¯åŠ¨æœåŠ¡

#### æ¨èæ–¹å¼ - ä½¿ç”¨ç®€å•å¯åŠ¨è„šæœ¬
```bash
node startSimplePaxos.cjs
```

#### Windowsç”¨æˆ·
```cmd
start_paxos_enhanced.bat
```

#### Linux/macOSç”¨æˆ·
```bash
chmod +x start_paxos_enhanced.sh
./start_paxos_enhanced.sh
```

### 3. éªŒè¯æœåŠ¡

å¯åŠ¨æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3002/health

# ç«¯å£æµ‹è¯•
node quick_port_test.cjs
```

## ğŸ“‹ æœåŠ¡é…ç½®

### å‘½ä»¤è¡Œå‚æ•°

- `--port` / `-p`: æœåŠ¡ç«¯å£ (é»˜è®¤: 3002)
- `--node-id` / `-n`: èŠ‚ç‚¹ID (é»˜è®¤: è‡ªåŠ¨ç”Ÿæˆ)
- `--log-level` / `-l`: æ—¥å¿—çº§åˆ« (é»˜è®¤: info)
- `--nodes`: èŠ‚ç‚¹åˆ—è¡¨ï¼Œé€—å·åˆ†éš”
- `--help` / `-h`: æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

### ç¤ºä¾‹
```bash
# ä½¿ç”¨é»˜è®¤è®¾ç½®å¯åŠ¨ï¼ˆæ¨èæ–¹å¼ï¼‰
node startSimplePaxos.cjs

# ä½¿ç”¨å¢å¼ºå¯åŠ¨è„šæœ¬
start_paxos_enhanced.bat  # Windows
./start_paxos_enhanced.sh # Linux/macOS

# ç«¯å£æµ‹è¯•
node quick_port_test.cjs
```

## ğŸ”§ APIæ¥å£

### 1. å¥åº·æ£€æŸ¥
```http
GET /health
```

### 2. åˆå§‹åŒ–ç½‘ç»œ
```http
POST /initialize
Content-Type: application/json

{
  "nodeIds": ["node1", "node2", "node3"]
}
```

### 3. åˆ†å€¼ä¿®æ”¹ä¸€è‡´æ€§æ£€æŸ¥
```http
POST /consistency/score-change
Content-Type: application/json

{
  "studentIds": ["2025000001", "2025000002"],
  "delta": -10,
  "reason": "è¿çºªæ‰£åˆ†",
  "operator": "admin"
}
```

### 4. ç”³è¯·å®¡æ ¸ä¸€è‡´æ€§æ£€æŸ¥
```http
POST /consistency/application-review
Content-Type: application/json

{
  "applicationId": "12345",
  "action": "approve",
  "reviewer": "admin",
  "reason": "å®¡æ ¸é€šè¿‡"
}
```

### 5. å½’æ¡£æ“ä½œä¸€è‡´æ€§æ£€æŸ¥
```http
POST /consistency/archive
Content-Type: application/json

{
  "grades": ["2020", "2021"],
  "reason": "å­¦æœŸç»“æŸå½’æ¡£",
  "operator": "admin"
}
```

### 6. è·å–ç³»ç»ŸçŠ¶æ€
```http
GET /status
```

### 7. å¼ºåˆ¶åŒæ­¥
```http
POST /sync
```

## ğŸ” ä½¿ç”¨ç¤ºä¾‹

### JavaScriptå®¢æˆ·ç«¯
```javascript
// é€šè¿‡ä¸»æœåŠ¡å™¨çš„Paxosé›†æˆæ¨¡å—ä½¿ç”¨
const axios = require('axios');

// æ£€æŸ¥åˆ†å€¼ä¿®æ”¹ä¸€è‡´æ€§
const result = await axios.post('http://localhost:3002/consistency/score-change', {
  studentIds: ['2025000001'],
  delta: -5,
  reason: 'è¿Ÿåˆ°æ‰£åˆ†',
  operator: 'teacher1'
});

if (result.data.success && result.data.result.allowed) {
  console.log('æ“ä½œå…è®¸æ‰§è¡Œ');
} else {
  console.log('æ“ä½œè¢«é˜»æ­¢:', result.data.result.conflicts);
}
```

### cURLç¤ºä¾‹
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3002/health

# åˆ†å€¼ä¿®æ”¹æ£€æŸ¥
curl -X POST http://localhost:3002/consistency/score-change \
  -H "Content-Type: application/json" \
  -d '{
    "studentIds": ["2025000001"],
    "delta": -5,
    "reason": "æµ‹è¯•",
    "operator": "admin"
  }'
```

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### æ ¸å¿ƒç»„ä»¶

1. **DistributedConsistencyService.cjs** - åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡æ ¸å¿ƒ
2. **PaxosManager.cjs** - Paxosåè®®ç®¡ç†å™¨
3. **PaxosService.cjs** - Express HTTPæœåŠ¡å™¨
4. **PaxosIntegration.cjs** - ä¸»æœåŠ¡å™¨é›†æˆæ¨¡å—
5. **startSimplePaxos.cjs** - ç®€å•å¯åŠ¨è„šæœ¬
6. **utils/portUtils.cjs** - ç«¯å£å·¥å…·æ¨¡å—

### ä¸€è‡´æ€§æ£€æµ‹æµç¨‹

1. **æ¥æ”¶è¯·æ±‚** - å®¢æˆ·ç«¯å‘é€ä¸€è‡´æ€§æ£€æŸ¥è¯·æ±‚
2. **å†²çªæ£€æµ‹** - æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¹¶å‘æ“ä½œå†²çª
3. **Paxoså…±è¯†** - é€šè¿‡Paxosç®—æ³•åœ¨èŠ‚ç‚¹é—´è¾¾æˆå…±è¯†
4. **è¿”å›ç»“æœ** - è¿”å›æ˜¯å¦å…è®¸æ“ä½œåŠç›¸å…³å»ºè®®

### å†²çªç±»å‹

- **åˆ†å€¼ä¿®æ”¹å†²çª**: åŒä¸€å­¦ç”Ÿçš„å¹¶å‘åˆ†å€¼ä¿®æ”¹
- **å®¡æ ¸å†²çª**: åŒä¸€ç”³è¯·çš„é‡å¤å®¡æ ¸
- **å½’æ¡£å†²çª**: å¹¶å‘å½’æ¡£æ“ä½œæˆ–å½’æ¡£æœŸé—´çš„å…¶ä»–æ“ä½œ

## ğŸ“Š ç›‘æ§ä¸è°ƒè¯•

### æ—¥å¿—è¾“å‡º
æœåŠ¡å¯åŠ¨åä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- èŠ‚ç‚¹çŠ¶æ€å˜åŒ–
- å…±è¯†è¿‡ç¨‹
- å†²çªæ£€æµ‹ç»“æœ
- æ€§èƒ½æŒ‡æ ‡

### çŠ¶æ€ç›‘æ§
é€šè¿‡ `/status` æ¥å£å¯ä»¥è·å–ï¼š
- èŠ‚ç‚¹å¥åº·çŠ¶æ€
- å…±è¯†ç»Ÿè®¡
- é”™è¯¯è®¡æ•°
- è¿è¡Œæ—¶é—´

### æ€§èƒ½æŒ‡æ ‡
- å¹³å‡å…±è¯†æ—¶é—´
- æˆåŠŸç‡
- ååé‡
- é”™è¯¯ç‡

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```
   Error: listen EADDRINUSE: address already in use :::3002
   ```
   è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨ `--port` å‚æ•°æŒ‡å®šå…¶ä»–ç«¯å£

2. **èŠ‚ç‚¹æ— æ³•é€šä¿¡**
   ```
   èŠ‚ç‚¹é—´é€šä¿¡å¤±è´¥
   ```
   è§£å†³æ–¹æ¡ˆ: æ£€æŸ¥é˜²ç«å¢™è®¾ç½®å’Œç½‘ç»œè¿æ¥

3. **å…±è¯†è¶…æ—¶**
   ```
   Consensus timeout
   ```
   è§£å†³æ–¹æ¡ˆ: æ£€æŸ¥èŠ‚ç‚¹æ•°é‡å’Œç½‘ç»œå»¶è¿Ÿ

### è°ƒè¯•æ¨¡å¼
```bash
# å¯åŠ¨ç®€å•PaxosæœåŠ¡è¿›è¡Œè°ƒè¯•
node startSimplePaxos.cjs

# ç«¯å£è¿é€šæ€§æµ‹è¯•
node quick_port_test.cjs

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
curl http://localhost:3002/health
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

- ç›®å‰ç‰ˆæœ¬ä¸ºå¼€å‘ç¯å¢ƒè®¾è®¡ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦æ·»åŠ è®¤è¯æœºåˆ¶
- å»ºè®®åœ¨å†…ç½‘ç¯å¢ƒä¸­ä½¿ç”¨
- å®šæœŸç›‘æ§ç³»ç»ŸçŠ¶æ€å’Œæ—¥å¿—

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### é…ç½®è°ƒä¼˜
- æ ¹æ®ç½‘ç»œå»¶è¿Ÿè°ƒæ•´è¶…æ—¶æ—¶é—´
- æ ¹æ®è´Ÿè½½è°ƒæ•´èŠ‚ç‚¹æ•°é‡
- ä¼˜åŒ–å¿ƒè·³é—´éš”

### ç›‘æ§æŒ‡æ ‡
- å…±è¯†å»¶è¿Ÿ
- ç½‘ç»œåˆ†åŒºæ£€æµ‹
- å†…å­˜å’ŒCPUä½¿ç”¨ç‡

## ğŸ”® æ‰©å±•åŠŸèƒ½

- æŒä¹…åŒ–å­˜å‚¨
- é›†ç¾¤è‡ªåŠ¨å‘ç°
- åŠ¨æ€èŠ‚ç‚¹æ·»åŠ /ç§»é™¤
- è´Ÿè½½å‡è¡¡
- ç¾éš¾æ¢å¤

## ğŸ“ æ”¯æŒ

### æœ€æ–°æ›´æ–° (2025å¹´6æœˆ3æ—¥)
æœ¬ç‰ˆæœ¬å·²ç»è¿‡é‡å¤§æ¸…ç†ä¼˜åŒ–ï¼š
- ç§»é™¤äº†é‡å¤å’Œè¿‡æ—¶çš„æ–‡ä»¶
- ä¿ç•™äº†æ ¸å¿ƒåŠŸèƒ½ç»„ä»¶
- ç®€åŒ–äº†å¯åŠ¨æµç¨‹
- æä¾›äº†æ›´ç¨³å®šçš„æœåŠ¡

### å½“å‰æ–‡ä»¶ç»“æ„
```
src/paxos/
â”œâ”€â”€ DistributedConsistencyService.cjs  # åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡æ ¸å¿ƒ
â”œâ”€â”€ PaxosIntegration.cjs              # ä¸»æœåŠ¡å™¨é›†æˆæ¨¡å—
â”œâ”€â”€ PaxosManager.cjs                  # Paxosåè®®ç®¡ç†å™¨
â”œâ”€â”€ PaxosService.cjs                  # HTTPæœåŠ¡å™¨
â”œâ”€â”€ startSimplePaxos.cjs              # ä¸»è¦å¯åŠ¨è„šæœ¬
â”œâ”€â”€ quick_port_test.cjs               # ç«¯å£æµ‹è¯•å·¥å…·
â”œâ”€â”€ start_paxos_enhanced.bat          # Windowså¢å¼ºå¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_paxos_enhanced.sh           # Linux/macOSå¢å¼ºå¯åŠ¨è„šæœ¬
â”œâ”€â”€ README.md                         # æœ¬è¯´æ˜æ–‡æ¡£
â””â”€â”€ utils/
    â””â”€â”€ portUtils.cjs                 # ç«¯å£å·¥å…·æ¨¡å—
```

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—è¾“å‡ºæˆ–è¿è¡Œå¥åº·æ£€æŸ¥è¿›è¡Œè¯Šæ–­ã€‚