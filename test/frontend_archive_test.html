<!DOCTYPE html>
<html>
<head>
    <title>å‰ç«¯å½’æ¡£åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .step { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        button { 
            background: #7b1fa2; color: white; padding: 10px 20px; 
            border: none; border-radius: 5px; cursor: pointer; margin: 5px;
        }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; margin-top: 20px; }
        .console-output { 
            background: #1e1e1e; color: #fff; padding: 15px; 
            border-radius: 5px; font-family: monospace; margin: 10px 0;
            max-height: 300px; overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å‰ç«¯å½’æ¡£åŠŸèƒ½è¯Šæ–­</h1>
        
        <div class="step">
            <h3>æ­¥éª¤ 1: æ£€æŸ¥å‰ç«¯é¡µé¢åŠ è½½</h3>
            <button onclick="loadFrontend()">åŠ è½½å‰ç«¯é¡µé¢</button>
            <button onclick="checkConsole()">æ£€æŸ¥æ§åˆ¶å°</button>
            <div id="frontend-status">ç­‰å¾…æµ‹è¯•...</div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤ 2: æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œ</h3>
            <button onclick="simulateLogin()">æ¨¡æ‹Ÿç™»å½•</button>
            <button onclick="simulateArchiveClick()">æ¨¡æ‹Ÿç‚¹å‡»å½’æ¡£åŠŸèƒ½</button>
            <div id="operation-status">ç­‰å¾…æ“ä½œ...</div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤ 3: ç»„ä»¶çŠ¶æ€æ£€æŸ¥</h3>
            <button onclick="checkComponents()">æ£€æŸ¥Reactç»„ä»¶</button>
            <div id="component-status">ç­‰å¾…æ£€æŸ¥...</div>
        </div>
        
        <div class="console-output" id="console-log">
            æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
        </div>
        
        <iframe id="test-frame" src="about:blank"></iframe>
    </div>

    <script>
        let consoleMessages = [];
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('console-log');
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            consoleMessages.push({timestamp, message, type});
        }
        
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'warning';
            element.innerHTML = `<div class="${className}">${message}</div>`;
        }
        
        function loadFrontend() {
            addLog('æ­£åœ¨åŠ è½½å‰ç«¯é¡µé¢...');
            const iframe = document.getElementById('test-frame');
            
            iframe.onload = () => {
                addLog('âœ… å‰ç«¯é¡µé¢åŠ è½½æˆåŠŸ', 'success');
                updateStatus('frontend-status', 'âœ… å‰ç«¯é¡µé¢åŠ è½½æˆåŠŸ', 'success');
                
                // å°è¯•æ£€æŸ¥é¡µé¢å†…å®¹
                try {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    if (doc) {
                        addLog('âœ… å¯ä»¥è®¿é—®é¡µé¢å†…å®¹', 'success');
                        
                        // æŸ¥æ‰¾Reactåº”ç”¨æ ¹å…ƒç´ 
                        const appRoot = doc.getElementById('root');
                        if (appRoot) {
                            addLog('âœ… æ‰¾åˆ°Reactåº”ç”¨æ ¹å…ƒç´ ', 'success');
                        } else {
                            addLog('âŒ æœªæ‰¾åˆ°Reactåº”ç”¨æ ¹å…ƒç´ ', 'error');
                        }
                    }
                } catch (e) {
                    addLog(`âš ï¸ æ— æ³•ç›´æ¥è®¿é—®é¡µé¢å†…å®¹: ${e.message}`, 'warning');
                }
            };
            
            iframe.onerror = () => {
                addLog('âŒ å‰ç«¯é¡µé¢åŠ è½½å¤±è´¥', 'error');
                updateStatus('frontend-status', 'âŒ å‰ç«¯é¡µé¢åŠ è½½å¤±è´¥', 'error');
            };
            
            iframe.src = 'http://localhost:3000';
        }
        
        function checkConsole() {
            addLog('å¼€å§‹ç›‘å¬æ§åˆ¶å°é”™è¯¯...');
            
            // ç›‘å¬å…¨å±€é”™è¯¯
            window.addEventListener('error', (e) => {
                addLog(`âŒ JavaScripté”™è¯¯: ${e.message} (${e.filename}:${e.lineno})`, 'error');
            });
            
            window.addEventListener('unhandledrejection', (e) => {
                addLog(`âŒ Promise rejection: ${e.reason}`, 'error');
            });
            
            addLog('âœ… é”™è¯¯ç›‘å¬å™¨å·²è®¾ç½®', 'success');
        }
        
        function simulateLogin() {
            addLog('æ¨¡æ‹Ÿç®¡ç†å‘˜ç™»å½•...');
            updateStatus('operation-status', 'æ­£åœ¨æ¨¡æ‹Ÿç™»å½•...', 'warning');
            
            // ä½¿ç”¨postMessageä¸iframeé€šä¿¡
            const iframe = document.getElementById('test-frame');
            if (iframe && iframe.contentWindow) {
                try {
                    iframe.contentWindow.postMessage({
                        type: 'SIMULATE_LOGIN',
                        username: 'admin',
                        password: 'admin123'
                    }, '*');
                    
                    addLog('âœ… ç™»å½•å‘½ä»¤å·²å‘é€', 'success');
                    updateStatus('operation-status', 'âœ… ç™»å½•å‘½ä»¤å·²å‘é€', 'success');
                } catch (e) {
                    addLog(`âŒ ç™»å½•æ¨¡æ‹Ÿå¤±è´¥: ${e.message}`, 'error');
                    updateStatus('operation-status', 'âŒ ç™»å½•æ¨¡æ‹Ÿå¤±è´¥', 'error');
                }
            } else {
                addLog('âŒ æ— æ³•æ‰¾åˆ°iframeæˆ–å…¶å†…å®¹çª—å£', 'error');
                updateStatus('operation-status', 'âŒ æ— æ³•è®¿é—®å‰ç«¯é¡µé¢', 'error');
            }
        }
        
        function simulateArchiveClick() {
            addLog('æ¨¡æ‹Ÿç‚¹å‡»å½’æ¡£åŠŸèƒ½...');
            updateStatus('operation-status', 'æ­£åœ¨æ¨¡æ‹Ÿç‚¹å‡»å½’æ¡£åŠŸèƒ½...', 'warning');
            
            const iframe = document.getElementById('test-frame');
            if (iframe && iframe.contentWindow) {
                try {
                    iframe.contentWindow.postMessage({
                        type: 'SIMULATE_ARCHIVE_CLICK'
                    }, '*');
                    
                    addLog('âœ… å½’æ¡£ç‚¹å‡»å‘½ä»¤å·²å‘é€', 'success');
                    updateStatus('operation-status', 'âœ… å½’æ¡£ç‚¹å‡»å‘½ä»¤å·²å‘é€', 'success');
                } catch (e) {
                    addLog(`âŒ å½’æ¡£ç‚¹å‡»æ¨¡æ‹Ÿå¤±è´¥: ${e.message}`, 'error');
                    updateStatus('operation-status', 'âŒ å½’æ¡£ç‚¹å‡»æ¨¡æ‹Ÿå¤±è´¥', 'error');
                }
            }
        }
        
        function checkComponents() {
            addLog('æ£€æŸ¥Reactç»„ä»¶çŠ¶æ€...');
            updateStatus('component-status', 'æ­£åœ¨æ£€æŸ¥ç»„ä»¶...', 'warning');
            
            // è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡postMessageè·å–ç»„ä»¶çŠ¶æ€
            const iframe = document.getElementById('test-frame');
            if (iframe && iframe.contentWindow) {
                iframe.contentWindow.postMessage({
                    type: 'CHECK_COMPONENTS'
                }, '*');
                
                addLog('âœ… ç»„ä»¶æ£€æŸ¥å‘½ä»¤å·²å‘é€', 'success');
            }
        }
        
        // ç›‘å¬æ¥è‡ªiframeçš„æ¶ˆæ¯
        window.addEventListener('message', (event) => {
            if (event.origin !== 'http://localhost:3000') return;
            
            const { type, data } = event.data;
            
            switch (type) {
                case 'COMPONENT_STATUS':
                    addLog(`ğŸ“Š ç»„ä»¶çŠ¶æ€: ${JSON.stringify(data)}`, 'success');
                    updateStatus('component-status', `ç»„ä»¶çŠ¶æ€å·²è·å–: ${JSON.stringify(data)}`, 'success');
                    break;
                case 'ARCHIVE_CLICK_RESULT':
                    addLog(`ğŸ¯ å½’æ¡£ç‚¹å‡»ç»“æœ: ${data.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, data.success ? 'success' : 'error');
                    break;
                case 'ERROR':
                    addLog(`âŒ å‰ç«¯é”™è¯¯: ${data.message}`, 'error');
                    break;
                default:
                    addLog(`ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: ${type}`, 'info');
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å¼€å§‹æ£€æŸ¥
        window.onload = () => {
            addLog('ğŸš€ è¯Šæ–­å·¥å…·å·²å¯åŠ¨');
            checkConsole();
        };
    </script>
</body>
</html>
