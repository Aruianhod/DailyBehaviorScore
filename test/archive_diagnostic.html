<!DOCTYPE html>
<html>
<head>
    <title>å½’æ¡£åŠŸèƒ½è¯Šæ–­</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .diagnostic { 
            background: #f5f5f5; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid #2196F3;
        }
        .error { border-left-color: #f44336; }
        .success { border-left-color: #4CAF50; }
        .warning { border-left-color: #ff9800; }
        button { 
            background: #7b1fa2; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background: #6a1a8c; }
    </style>
</head>
<body>
    <h1>ğŸ” å½’æ¡£åŠŸèƒ½è¯Šæ–­å·¥å…·</h1>
    
    <button onclick="checkAPIs()">æ£€æŸ¥åç«¯API</button>
    <button onclick="checkFrontend()">æ£€æŸ¥å‰ç«¯çŠ¶æ€</button>
    <button onclick="simulateClick()">æ¨¡æ‹Ÿç‚¹å‡»å½’æ¡£åŠŸèƒ½</button>
    <button onclick="checkConsole()">æ£€æŸ¥æ§åˆ¶å°é”™è¯¯</button>
    
    <div id="diagnostics"></div>

    <script>
        function addDiagnostic(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `diagnostic ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            document.getElementById('diagnostics').appendChild(div);
        }
        
        async function checkAPIs() {
            addDiagnostic('æ­£åœ¨æ£€æŸ¥å½’æ¡£ç›¸å…³API...');
            
            try {
                // æ£€æŸ¥å½’æ¡£ç»Ÿè®¡API
                const statsResponse = await fetch('http://localhost:3000/api/admin/archive/stats');
                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    addDiagnostic(`âœ… å½’æ¡£ç»Ÿè®¡APIæ­£å¸¸ - æ€»å­¦ç”Ÿæ•°: ${statsData.totalStudents}`, 'success');
                } else {
                    addDiagnostic(`âŒ å½’æ¡£ç»Ÿè®¡APIé”™è¯¯ - çŠ¶æ€ç : ${statsResponse.status}`, 'error');
                }
                
                // æ£€æŸ¥å½’æ¡£å†å²API
                const logsResponse = await fetch('http://localhost:3000/api/admin/archive/logs');
                if (logsResponse.ok) {
                    const logsData = await logsResponse.json();
                    addDiagnostic(`âœ… å½’æ¡£å†å²APIæ­£å¸¸ - è®°å½•æ•°: ${logsData.logs?.length || 0}`, 'success');
                } else {
                    addDiagnostic(`âŒ å½’æ¡£å†å²APIé”™è¯¯ - çŠ¶æ€ç : ${logsResponse.status}`, 'error');
                }
            } catch (error) {
                addDiagnostic(`âŒ APIæ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function checkFrontend() {
            addDiagnostic('æ­£åœ¨æ£€æŸ¥å‰ç«¯çŠ¶æ€...');
            
            // å°è¯•è¿æ¥åˆ°å‰ç«¯
            const iframe = document.createElement('iframe');
            iframe.src = 'http://localhost:3000';
            iframe.style.display = 'none';
            iframe.onload = () => {
                addDiagnostic('âœ… å‰ç«¯é¡µé¢å¯ä»¥åŠ è½½', 'success');
                // æ£€æŸ¥Reactç»„ä»¶
                try {
                    const adminDashboard = iframe.contentWindow;
                    if (adminDashboard) {
                        addDiagnostic('âœ… å‰ç«¯é¡µé¢å†…å®¹å¯è®¿é—®', 'success');
                    }
                } catch (e) {
                    addDiagnostic('âš ï¸ æ— æ³•è®¿é—®å‰ç«¯é¡µé¢å†…å®¹ï¼ˆè·¨åŸŸé™åˆ¶ï¼‰', 'warning');
                }
            };
            iframe.onerror = () => {
                addDiagnostic('âŒ å‰ç«¯é¡µé¢åŠ è½½å¤±è´¥', 'error');
            };
            document.body.appendChild(iframe);
        }
        
        function simulateClick() {
            addDiagnostic('æ­£åœ¨æ¨¡æ‹Ÿå½’æ¡£åŠŸèƒ½ç‚¹å‡»...');
            
            // åœ¨æ–°çª—å£ä¸­æ‰“å¼€å‰ç«¯é¡µé¢
            const newWindow = window.open('http://localhost:3000', '_blank');
            
            setTimeout(() => {
                addDiagnostic('ğŸ”— å·²åœ¨æ–°çª—å£æ‰“å¼€å‰ç«¯é¡µé¢ï¼Œè¯·æ‰‹åŠ¨æµ‹è¯•å½’æ¡£åŠŸèƒ½', 'warning');
                addDiagnostic('ğŸ“ æµ‹è¯•æ­¥éª¤ï¼š1. ç™»å½•ç®¡ç†å‘˜è´¦å· 2. ç‚¹å‡»"å½’æ¡£åŠŸèƒ½"å¡ç‰‡ 3. æŸ¥çœ‹æ˜¯å¦æ­£å¸¸è¿›å…¥å½’æ¡£é¡µé¢');
            }, 1000);
        }
        
        function checkConsole() {
            addDiagnostic('æ­£åœ¨æ£€æŸ¥æ§åˆ¶å°é”™è¯¯...');
            
            // ç›‘å¬é”™è¯¯
            window.addEventListener('error', (e) => {
                addDiagnostic(`âŒ JavaScripté”™è¯¯: ${e.message}`, 'error');
            });
            
            // æ£€æŸ¥ç½‘ç»œé”™è¯¯
            window.addEventListener('unhandledrejection', (e) => {
                addDiagnostic(`âŒ Promiseé”™è¯¯: ${e.reason}`, 'error');
            });
            
            addDiagnostic('âœ… é”™è¯¯ç›‘å¬å™¨å·²è®¾ç½®', 'success');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = () => {
            addDiagnostic('ğŸš€ è¯Šæ–­å·¥å…·å·²å¯åŠ¨');
            checkAPIs();
        };
    </script>
</body>
</html>
